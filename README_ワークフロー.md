# 音声ファイル自動文字起こしワークフロー

音声ファイルを自動的に文字起こしし、AI分析で構造化・要約して、Obsidianノートとして保存する自動化ワークフローです。

## 📁 フォルダ構造

```
KadaiObsidian/
├── 00ボイスメモ/          # 入力: 音声ファイルを配置
│   └── processed/         # アーカイブ: 処理済み音声ファイル
├── 01文字起こし/          # 出力: 生成されたマークダウンファイル
├── process_voice_memos.py # メインスクリプト
└── .env                   # OpenAI APIキー設定
```

## 🚀 セットアップ

### 1. 必要なライブラリのインストール

```bash
pip install openai python-dotenv
```

### 2. APIキーの設定

`.env`ファイルにOpenAI APIキーを設定してください:

```
OPENAI_API_KEY=sk-your-actual-api-key-here
```

## 📝 使用方法

### 基本的な使い方

1. 音声ファイルを`00ボイスメモ/`フォルダに配置
2. スクリプトを実行:

```bash
python3 process_voice_memos.py
```

3. `01文字起こし/`フォルダに生成されたマークダウンファイルを確認

### 処理の流れ

1. **音声ファイル検出**: `00ボイスメモ/`内の.m4a/.mp3/.wavファイルを検出
2. **既存文字起こしの検索**: 
   - 同名の.txtファイルを検索（`00ボイスメモ/`と`processed/`内）
   - 存在する場合は優先使用（**重要**: APIコスト削減）
3. **新規文字起こし**: .txtがない場合のみOpenAI Whisper APIで変換
4. **AI分析**: OpenAI GPTで要約と構造化を実行
5. **Obsidianノート生成**: 
   - YAMLフロントマター
   - 音声埋め込みリンク
   - 要約
   - 構造化された内容
   - 全文文字起こし
6. **保存**: `01文字起こし/`にマークダウン形式で保存
7. **アーカイブ**: 処理済み音声ファイルを`00ボイスメモ/processed/`に移動

## 📄 生成されるノートの形式

```markdown
---
タイトル: [AIが生成したタイトル]
作成日: 2026-01-11
元ファイル: 音声ファイル.m4a
タグ:
  - 文字起こし
  - 音声
  - [その他のタグ]
カテゴリ: 音声メモ
---

![[音声ファイル.m4a]]

## 📝 要約

[AIが生成した要約]

## 🗂️ 内容

### [見出し1]

[内容の要約]

### [見出し2]

[内容の要約]

## 📄 全文文字起こし

[完全な文字起こしテキスト]

---

*文字起こし日時: 2026-01-11*  
*使用ツール: OpenAI Whisper API*
```

## 💡 重要なポイント

### 既存.txtファイルの優先使用

- **コスト削減**: 既存の.txtファイルがある場合は、必ずその内容を使用します
- OpenAI Whisper APIは呼ばれません
- 手動で作成した.txtファイルも使用可能

### サポートされている音声形式

- .m4a
- .mp3
- .wav
- .mp4

### ファイルサイズ制限

- OpenAI Whisper API: 25MB以下

## 🔧 トラブルシューティング

### エラー: OPENAI_API_KEYが設定されていません

`.env`ファイルを確認し、正しいAPIキーが設定されているか確認してください。

### 音声ファイルが見つかりません

`00ボイスメモ/`フォルダに音声ファイル（.m4a, .mp3, .wav）が存在するか確認してください。

### 文字起こしに失敗しました

- ファイルサイズが25MB以下か確認
- インターネット接続を確認
- OpenAI APIの利用状況を確認

## 📊 バッチ処理

複数の音声ファイルを一度に処理できます。`00ボイスメモ/`に複数のファイルを配置してスクリプトを実行すると、順次処理されます。

エラーが発生しても、次のファイルの処理は継続されます。

## 🏷️ タグとカテゴリ

AIが自動的に以下を生成します:

- **タイトル**: 内容を表す簡潔なタイトル
- **要約**: 3-5行程度の要約
- **タグ**: 内容に関連するタグ
- **構造化された見出し**: 内容を整理した見出しと要約

## 📞 サポート

問題が発生した場合は、スクリプト実行時のログを確認してください。詳細なエラーメッセージが表示されます。
